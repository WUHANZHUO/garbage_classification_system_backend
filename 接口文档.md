

# 垃圾分类系统接口文档

## 用户模块

### **用户注册页面**

**功能描述：**用户注册

**请求参数：**

```json
{"username": "xx", "password": "yy"}
```

**响应数据：**

①注册成功（201）：

```json
{ "message": "用户注册成功"}
```

②注册失败（409）：

```json
{"message": "用户名已存在"}
```

**类型：**POST

**路径：**/api/auth/register

**备注：**无



### 用户登录页面

**功能描述：**用户/管理员登录

**请求参数：**

```json
{"username": "xx", "password": "yy"}
```

**响应数据：**

①登陆成功（200）：

```json
{

  "message": "登录成功",

  "role": 0,

  "token": "xx.yy.zz"

}
```

②登陆失败：

401:

```json
{"message": "用户名或密码错误"}
```

403 Forbidden：

```
{'message': '该账户已被封禁，请联系管理员'}
```

**类型：**POST

**路径：**/api/auth/login

**备注：**role:0表示普通用户，1表示管理员

测试账号：

```json
{"username": "admintest", "password": "admintest"}

{"username": "usertest", "password": "usertest"}
```



### 修改个人密码 

**功能描述：** 登录用户修改自己的密码 

**请求头：**

```
Authorization: Bearer <用户token> 
Content-Type: application/json
```

**请求参数：**

```
{
  "current_password": "old_password",
  "new_password": "new_password"
}
```

**响应数据：**

成功响应 (200):

```
{ "message": "密码修改成功" }
```

失败响应:

400 Bad Request:

```
{"message": "请求参数不完整"}
```

401 Unauthorized:

```
{"message": "缺少认证令牌"}
```

403 Forbidden:

```
{"message": "当前密码不正确"}
```

```
{"message": "该账户已被封禁"}
```

**类型：** PUT

**路径：** /api/auth/change_password

**备注：** 用户必须处于登录状态。



## 管理员模块

### 获取用户列表

**功能描述：**获取所有用户列表

**请求头：**

```
Authorization: Bearer <管理员token>

Content-Type: application/json
```

**请求参数：**无

**响应数据：**

成功响应（200）：

```json
[
  {
    "id": 1,
    "username": "admintest",
    "role": 1,
    "points": 0,
    "status": 0
  },
  {
    "id": 2,
    "username": "usertest",
    "role": 0,
    "points": 100,
    "status": 0
  }
]
```

失败响应：

401 Unauthorized：

```
{'message': '令牌格式错误，应为 "Bearer <token>"'}
```

```
{'message': '无效的用户'}
```

```
{"message": "缺少认证令牌"}
```

```
{"message": "无效的令牌"}
```

```
{'message': '令牌已过期'}
```

```
{'message': '无效的令牌'}
```

403 Forbidden：

```
{"message": "需要管理员权限"}
```

**类型：**GET

**路径：**/api/admin/users

**备注：**测试账号：

```
{"username": "admintest", "password": "admintest"}
```



### 获取单个用户详情

**功能描述：**获取单个用户详情

**请求头：**

```
Authorization: Bearer <管理员token>

Content-Type: application/json
```

**请求参数：**无

**响应数据：**

成功响应（200）：

```
{

  "id": 2,

  "points": 0,

  "role": 0,

  "status": 1,

  "username": "test222"

}
```

失败响应：

400 Bad Request：

```
{"message": "无效的状态值"}
```

401 Unauthorized：

```
{"message": "缺少认证令牌"}
```

403 Forbidden：

```
{"message": "需要管理员权限"}
```

404 Not Found：用户不存在

**类型：**GET

**路径：**/api/admin/users/\{int:user_id}

**备注：**无



### 封禁/解封用户

**功能描述：**封禁/解封用户

**请求头：**

```
Authorization: Bearer <管理员token>

Content-Type: application/json
```

**请求参数：**

```
{"status": 1}
```

**响应数据：**

成功响应：

```json
{
    "message": "用户 test111 状态已更新",
    "user": {
        "id": 1,
     	"points": 0,
        "role": 0,
        "status": 1,
        "username": "test111"
  }
}
```

失败响应：

400 Bad Request：

```
{"message": "无效的状态值"}
```

401 Unauthorized：

```
{"message": "缺少认证令牌"}
```

403 Forbidden：

```
{"message": "需要管理员权限"}
```

404 Not Found：用户不存在

**类型：**PUT

**路径：**/api/admin/users/{int:user_id}/status

**备注：**status: 账户状态（0=解封，1=封禁）



### 创建管理员账号

**功能描述：**创建管理员账号

**请求头：**

```
Authorization: Bearer <管理员token>

Content-Type: application/json
```

**请求参数：**

```
{"username": "newadmin",  "password": "newpassword123" }
```

**响应数据：**

成功响应：

```
{
  "message": "管理员账户创建成功",
  "user": {
     "id": 9,
     "points": 0,
     "role": 1,
     "status": 0,
     "username": "newadmin"
  }
}
```

失败响应：

401 Unauthorized：

```
{"message": "缺少认证令牌"}
```

403 Forbidden：

```
{"message": "需要管理员权限"}
```

409 Conflict：

```
{"message": "用户名已存在"}
```

**类型：**POST

**路径：**/api/admin/users/create_admin

**备注：**无



### 修改用户密码

**功能描述：**管理员修改用户密码

**请求头：**

```
Authorization: Bearer <管理员token> 
Content-Type: application/json
```

**请求参数：**

```
{ "new_password": "new_password" }
```

**响应数据：**

成功响应 (200):

```
{ "message": "用户 't' 的密码已更新" }
```

失败响应:

400 Bad Request:

```
{"message": "缺少新密码"}
```

401 Unauthorized:

```
{"message": "缺少认证令牌"}
```

403 Forbidden:

```
{"message": "需要管理员权限"}
```

404 Not Found：用户不存在

**类型：**PUT

**路径：**/api/admin/users/{int:user_id}/set_password

**备注：**无







————————————————————————

**功能描述：**

**请求头：**

**请求参数：**

**响应数据：**

​	

**类型：**

**路径：**

**备注：**



