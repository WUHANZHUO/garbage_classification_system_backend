

# 垃圾分类系统接口文档

## 用户模块

### **用户注册页面**

**功能描述：** 用户注册

**路径：**/api/auth/register

**类型：** POST

**请求参数：**

```json
{"username": "xx", "password": "yy"}
```

**参数描述：**

`username`（varchar，必需）：用户名

`password`（varchar，必需）：用户密码

**响应数据：**

①注册成功（201）：

```json
{ "message": "用户注册成功"}
```

②注册失败（409）：

```json
{"message": "用户名已存在"}
```

**备注：** 无



### 用户登录页面

**功能描述：** 用户/管理员登录

**路径：**/api/auth/login

**类型：** POST

**请求参数：**

```json
{"username": "xx", "password": "yy"}
```

**参数描述：**

`username`（varchar，必需）：用户名

`password`（varchar，必需）：用户密码

**响应数据：**

①登陆成功（200）：

```json
{

  "message": "登录成功",

  "role": 0,

  "token": "xx.yy.zz"

}
```

②登陆失败：

401:

```json
{"message": "用户名或密码错误"}
```

403 Forbidden：

```
{'message': '该账户已被封禁，请联系管理员'}
```

**备注：**

role:0表示普通用户，1表示管理员

测试账号：

```json
{"username": "admintest", "password": "admintest"}

{"username": "usertest", "password": "usertest"}
```



### 修改个人密码 

**功能描述：**  登录用户修改自己的密码 

**路径：** /api/auth/change_password

**类型：**  PUT

**请求头：**

```
Authorization: Bearer <用户token> 
Content-Type: application/json
```

**请求参数：**

```
{
  "current_password": "old_password",
  "new_password": "new_password"
}
```

**参数描述：**

`current_password`（varchar，必需）：当前密码

`new_password`（varchar，必需）：新密码

**响应数据：**

成功响应 (200):

```
{ "message": "密码修改成功" }
```

失败响应:

400 Bad Request:

```
{"message": "请求参数不完整"}
```

401 Unauthorized:

```
{"message": "缺少认证令牌"}
```

403 Forbidden:

```
{"message": "当前密码不正确"}
```

```
{"message": "该账户已被封禁"}
```

**备注：**  用户必须处于登录状态。



## 管理员模块

### 获取用户列表

**功能描述：** 获取所有用户列表

**路径：**/api/admin/users

**类型：** GET

**请求头：**

```
Authorization: Bearer <管理员token>

Content-Type: application/json
```

**请求参数：** 无

**响应数据：**

成功响应（200）：

```json
[
  {
    "id": 1,
    "username": "admintest",
    "role": 1,
    "points": 0,
    "status": 0
  },
  {
    "id": 2,
    "username": "usertest",
    "role": 0,
    "points": 100,
    "status": 0
  }
]
```

失败响应：

401 Unauthorized：

```
{'message': '令牌格式错误，应为 "Bearer <token>"'}
```

```
{'message': '无效的用户'}
```

```
{"message": "缺少认证令牌"}
```

```
{"message": "无效的令牌"}
```

```
{'message': '令牌已过期'}
```

```
{'message': '无效的令牌'}
```

403 Forbidden：

```
{"message": "需要管理员权限"}
```

**备注：**

测试账号：

```
{"username": "admintest", "password": "admintest"}
```



### 获取单个用户详情

**功能描述：** 获取单个用户详情

**路径：**/api/admin/users/\{int:user_id}

**类型：** GET

**路径参数：**

`{int:user_id}`：用户id

**请求头：**

```
Authorization: Bearer <管理员token>

Content-Type: application/json
```

**请求参数：** 无

**响应数据：**

成功响应（200）：

```
{

  "id": 2,

  "points": 0,

  "role": 0,

  "status": 1,

  "username": "test222"

}
```

失败响应：

400 Bad Request：

```
{"message": "无效的状态值"}
```

401 Unauthorized：

```
{"message": "缺少认证令牌"}
```

403 Forbidden：

```
{"message": "需要管理员权限"}
```

404 Not Found：用户不存在

**备注：** 无



### 封禁/解封用户

**功能描述：** 封禁/解封用户

**路径：**/api/admin/users/{int:user_id}/status

**类型：** PUT

**路径参数：**

`{int:user_id}`：用户id

**请求头：**

```
Authorization: Bearer <管理员token>

Content-Type: application/json
```

**请求参数：**

```
{"status": 1}
```

**请求参数：**

`status`（int，必需）：账号状态，(0: 普通用户, 1: 管理员)

**响应数据：**

成功响应：

```json
{
    "message": "用户 test111 状态已更新",
    "user": {
        "id": 1,
     	"points": 0,
        "role": 0,
        "status": 1,
        "username": "test111"
  }
}
```

失败响应：

400 Bad Request：

```
{"message": "无效的状态值"}
```

401 Unauthorized：

```
{"message": "缺少认证令牌"}
```

403 Forbidden：

```
{"message": "需要管理员权限"}
```

404 Not Found：用户不存在

**备注：** 无



### 创建管理员账号

**功能描述：** 创建管理员账号

**路径：**/api/admin/users/create_admin

**类型：** POST

**请求头：**

```
Authorization: Bearer <管理员token>

Content-Type: application/json
```

**请求参数：**

```
{"username": "newadmin",  "password": "newpassword123" }
```

**参数描述：**

`username`（varchar，必需）：用户名

`password`（varchar，必需）：用户密码

**响应数据：**

成功响应：

```
{
  "message": "管理员账户创建成功",
  "user": {
     "id": 9,
     "points": 0,
     "role": 1,
     "status": 0,
     "username": "newadmin"
  }
}
```

失败响应：

401 Unauthorized：

```
{"message": "缺少认证令牌"}
```

403 Forbidden：

```
{"message": "需要管理员权限"}
```

409 Conflict：

```
{"message": "用户名已存在"}
```

**备注：** 无



### 修改用户密码

**功能描述：** 管理员修改用户密码

**路径：**/api/admin/users/{int:user_id}/set_password

**类型：** PUT

**路径参数：**

`{int:user_id}`：用户id

**请求头：**

```
Authorization: Bearer <管理员token> 
Content-Type: application/json
```

**请求参数：**

```
{ "new_password": "new_password" }
```

**参数描述：**

`new_password`（varchar，必需）：要更改的新密码

**响应数据：**

成功响应 (200):

```
{ "message": "用户 't' 的密码已更新" }
```

失败响应:

400 Bad Request:

```
{"message": "缺少新密码"}
```

401 Unauthorized:

```
{"message": "缺少认证令牌"}
```

403 Forbidden:

```
{"message": "需要管理员权限"}
```

404 Not Found：用户不存在

**备注：** 无



## 文章模块

### 获取文章列表

**功能描述：** 获取所有 status 为 0 (已发布) 的文章列表

**路径：**/api/articles/get

**类型：** GET

**请求头：** 无

**请求参数：** 无

**响应数据：**

```
[
  {
     "author_id": 3,
     "author_name": "admin",
     "content": "测试测试测试",
     "id": 1,
     "status": 0,
     "title": "测试",
     "updated_time": "2025-06-28 15:44:45"
  }
]
```

**备注：** 无需登录；status为1的文章不可见



### 获取单篇文章详情

**功能描述：** 所有人都可以获取文章列表

**路径：**/api/articles/get/{int:article_id}

**类型：** GET

**路径参数：**

`{int:article_id}`：文章id

**请求头：** 无

**请求参数：** 无

**响应数据：**

```
{
    "author_id": 3,
    "author_name": "admin",
    "content": "测试测试测试",
    "id": 1,
    "status": 0,
    "title": "测试",
    "updated_time": "2025-06-28 15:44:45"
}
```

**备注：** 无需登录



### 创建文章

**功能描述：** 管理员可以创建文章

**路径：**/api/articles/create

**类型：** POST

**请求头：**

```
Authorization: Bearer <管理员token>

Content-Type: application/json
```

**请求参数：**

```
{
	"title": "new_title",
	"content": "new_content"
}
```

**请求参数：**

`title`（varchar，必需）：文章标题

`content`（varchar，必需）：文章内容

**响应数据：**

成功响应：

```
{
    "article": {
        "author_id": 5,
        "author_name": "admintest",
        "content": "new_content444",
        "id": 6,
        "status": 0,
        "title": "1111",
        "updated_time": "2025-07-01 02:23:03"
    },
    "message": "文章创建成功"
}
```

失败响应：

401 Unauthorized：

```
{"message": "缺少认证令牌"}
```

403 Forbidden：

```
{"message": "需要管理员权限"}
```

**备注：** 无



### 修改文章

**功能描述：** 管理员可以修改文章

**路径：**/api/articles/revise/{int:article_id}

**类型：** PUT

**路径参数：**

`{int:article_id}`：文章id

**请求头：**

```
Authorization: Bearer <管理员token>

Content-Type: application/json
```

**请求参数：**

```
{
	"title": "title",
	"content": "content"
}
```

**请求参数：**

`title`（varchar，非必需）：文章标题

`content`（varchar，非必需）：文章内容

**响应数据：**

成功响应：

```
{
    "article": {
        "author_id": 5,
        "author_name": "admintest",
        "content": "new_content444",
        "id": 4,
        "status": 0,
        "title": "new_title",
        "updated_time": "2025-07-01 02:21:02"
    },
    "message": "文章更新成功"
}
```

失败响应：

401 Unauthorized：

```
{"message": "缺少认证令牌"}
```

403 Forbidden：

```
{"message": "需要管理员权限"}
```

**备注：** 无



### 删除文章

**功能描述：** 管理员可以逻辑删除文章

**路径：**/delete/{int:article_id}

**类型：** DELETE

**路径参数：**

`{int:article_id}`：文章id

**请求头：**

```
Authorization: Bearer <管理员token>

Content-Type: application/json
```

**请求参数：** 无

**响应数据：**

成功响应：

```
{

  "message": "文章已删除"

}
```

失败响应：

401 Unauthorized：

```
{"message": "缺少认证令牌"}
```

403 Forbidden：

```
{"message": "需要管理员权限"}
```

**备注：** 无



## 识别模块

### 文字识别

**功能描述：** 输入文字进行模糊匹配，返回垃圾类型。

**路径：** /api/recognize/text

**类型：** GET

**路径参数：** q

例如：`http://ip:5000/api/recognize/text?q=香蕉`

**请求头：** 无

**响应数据：** 

成功响应：

```
[
  {
     "category": "厨余垃圾",
     "id": 163,
     "name": "香蕉"
  }
]
```

失败响应：

400 Bad Request:

```
{"message": "缺少查询参数 q"}
```

404 Not Found:

```
{"message": "未找到匹配的垃圾信息"}
```

**备注：** 无





# 完成情况

|  模块名称  |     功能名称     | 后端实现 | 后端测试 | 前端联调 |
| :--------: | :--------------: | :------: | :------: | :------: |
|  用户模块  |     用户注册     |   完成   |   完成   |   完成   |
|  用户模块  |     用户登陆     |   完成   |   完成   |   完成   |
|  用户模块  |   修改个人密码   |   完成   |   完成   |   完成   |
| 管理员模块 |   获取用户列表   |   完成   |   完成   |          |
| 管理员模块 | 获取单个用户详情 |   完成   |   完成   |          |
| 管理员模块 |  封禁/解封用户   |   完成   |   完成   |          |
| 管理员模块 |  创建管理员账号  |   完成   |   完成   |          |
| 管理员模块 |   修改用户密码   |   完成   |   完成   |          |
|  文章模块  |   获取文章列表   |   完成   |   完成   |          |
|  文章模块  | 获取单篇文章详情 |   完成   |   完成   |          |
|  文章模块  |     创建文章     |   完成   |   完成   |          |
|  文章模块  |     修改文章     |   完成   |   完成   |          |
|  文章模块  |     删除文章     |   完成   |   完成   |          |
|            |                  |          |          |          |
|            |                  |          |          |          |
|            |                  |          |          |          |
|            |                  |          |          |          |
|            |                  |          |          |          |
|            |                  |          |          |          |

————————————————————————

**功能描述：**

**路径：** 

**类型：** 

**路径参数：**

``（可选）

**请求头：** 

**请求参数：**

``（可选）

**参数描述：** 

**响应数据：** 

**备注：** 



